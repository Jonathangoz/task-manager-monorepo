# services/task-service/Dockerfile.dev
FROM node:22-alpine

# Instalar pnpm globalmente
RUN npm install -g pnpm@latest

# Crear directorio de trabajo
WORKDIR /app

# Instalar herramientas necesarias
RUN apk add --no-cache curl redis

# Copiar archivos de configuración
COPY package.json pnpm-lock.yaml* ./
COPY prisma ./prisma

# Instalar dependencias (incluyendo dev)
RUN pnpm install --frozen-lockfile

# Generar cliente de Prisma
RUN pnpm prisma:generate

# Copiar código fuente
COPY . .

# Exponer puerto
EXPOSE 3002

# Variables de entorno para desarrollo
ENV NODE_ENV=development

# Script de inicio que incluye migraciones
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Comando de desarrollo
ENTRYPOINT ["docker-entrypoint.sh"]
CMD ["pnpm", "dev"]